apiVersion: v1
kind: Namespace
metadata:
  name: sentinelone-pov
  labels:
    # Pod Security Standards (PSS) namespace labels:
    #
    # 1) AUDIT: records violations to the Kubernetes audit log, but does NOT block.
    #    Use this to understand what would break before turning on enforcement.
    pod-security.kubernetes.io/audit: restricted
    pod-security.kubernetes.io/audit-version: latest
  
    # 2) WARN: returns user-visible warnings on kubectl apply/create, but does NOT block.
    #    Great for developer feedback without breaking deployments.
    pod-security.kubernetes.io/warn: restricted
    pod-security.kubernetes.io/warn-version: latest
  
    # 3) ENFORCE: BLOCKS pods that violate the profile (admission denies the request).
    #    Turn this on only after you've validated workloads via audit/warn.
    # pod-security.kubernetes.io/enforce: restricted
    # pod-security.kubernetes.io/enforce-version: latest
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sentinelone-pov
  namespace: sentinelone-pov
spec:
  replicas: 1
  selector:
    matchLabels:
      app: sentinelone-pov
  template:
    metadata:
      labels:
        app: sentinelone-pov
    spec:
      containers:
      - name: sentinelone-pov
        # image: public.ecr.aws/bitnami/python:3.11
        image: public.ecr.aws/bitnami/python@sha256:bc6eb86206dce05044af84ebc7fd48ac0c9fecfee975296c8cdd93d5bd25f3f1  # NOTE: This is the linux/amd64 image
        
          # ⬆️ Uncommenting the digest-pinned image (and commenting out the tag-based image):
          #    - Replaces a mutable tag ("3.11-slim") with an immutable SHA256 digest
          #    - Guarantees the exact same image is used every time
          #    - Prevents supply-chain attacks via tag replacement
          #    - Improves auditability and reproducibility
        command: ["sh", "-c", "echo SentinelOne POV running; sleep 3600"]
        securityContext:
          capabilities:
            drop: ["ALL"]
          
          # ⬆️ Uncommenting this securityContext:
          #    - Drops all Linux capabilities from the container
          #    - Prevents privilege escalation via kernel capabilities
          #    - Aligns with the Pod Security "restricted" profile
          #   
          #    This significantly reduces the container’s attack surface
          #    and is considered a baseline hardening best practice.
          #
          # Required by Pod Security "restricted"
          # ------------------------------------
          # Prevents the container from gaining additional privileges
          # via setuid/setgid binaries or other escalation mechanisms.
          allowPrivilegeEscalation: false

          # Required by Pod Security "restricted"
          # ------------------------------------
          # Ensures the container does NOT run as UID 0 (root).
          # Reduces blast radius if the container is compromised.
          runAsNonRoot: true
          runAsUser: 1000
          runAsGroup: 1000

          # Required by Pod Security "restricted"
          # ------------------------------------
          # Applies the default seccomp profile to restrict kernel syscalls.
          # This significantly reduces the kernel attack surface and
          # blocks many container escape techniques.
          seccompProfile:
            type: RuntimeDefault
